(window.webpackJsonp=window.webpackJsonp||[]).push([[265],{727:function(s,n,a){"use strict";a.r(n);var e=a(35),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_88-06-结算-收货地址-修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_88-06-结算-收货地址-修改"}},[s._v("#")]),s._v(" 88-06-结算-收货地址-修改")]),s._v(" "),a("blockquote",[a("p",[s._v("目的：在添加收货地址组件基础之上完成修改逻辑。")])]),s._v(" "),a("p",[s._v("大致步骤：")]),s._v(" "),a("ul",[a("li",[s._v("打开对话框的时候传人当前需要修改的地址对象")]),s._v(" "),a("li",[s._v("再添加组件open函数处，接收数据赋值给表单，修改标题。")]),s._v(" "),a("li",[s._v("封装一个API接口函数实现修改，在提交事件中合并修改操作")]),s._v(" "),a("li",[s._v("父组件修改数据")])]),s._v(" "),a("p",[s._v("落的代码：")]),s._v(" "),a("ol",[a("li",[s._v("打开对话框的时候传人当前需需改的地址对象")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('src/views/member/pay/checkout-address.vue\n<a @click="openAddressEdit(showAddress)" v-if="showAddress" href="javascript:;">修改地址</a>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",[a("li",[s._v("再添加组件open函数处，接收数据赋值给表单，修改标题")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("src/views/member/pay/address-edit.vue\n    const formData = reactive({\n+      id: '',\n      receiver: '',\n      contact: '',\n      provinceCode: '',\n      cityCode: '',\n      countyCode: '',\n+      fullLocation: '',\n      address: '',\n      postalCode: '',\n      addressTags: '',\n      isDefault: 0\n    })\n<XtxDialog :title=\"(formData.id?'编辑':'添加')+'收货地址'\" v-model:visible=\"dialogVisible\">\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ol",[a("li",[s._v("封装一个API接口函数实现修改，在提交事件中合并修改操作")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("src/api/order.js\n/**\n * 编辑收货地址信息\n * @param {Object} address - 地址对象\n */\nexport const editAddress = (address) => {\n  return request('/member/address', 'put', address)\n}\nsrc/views/member/pay/address-edit.vue\n    // 打开对话框函数\n    const open = (address) => {\n      // 先填充数据 - 编辑\n      if (address.id) {\n        for (const key in formData) {\n          formData[key] = address[key]\n        }\n      } else {\n        // 先清空数据 - 添加\n        for (const key in formData) {\n          if (key !== 'isDefault') {\n            formData[key] = ''\n          }\n        }\n      }\n      dialogVisible.value = true\n    }\n    // 提交操作\n    const app = getCurrentInstance()\n    const submit = () => {\n+      if (formData.id) {\n+        editAddress(formData).then(data => {\n+          // 修改成功\n+          Message(app, { text: '修改收货地址成功', type: 'success' })\n+          dialogVisible.value = false\n+          emit('on-success', formData)\n+        })\n+      } else {\n        addAddress(formData).then(data => {\n          // 添加成功\n          Message(app, { text: '添加收货地址成功', type: 'success' })\n          formData.id = data.result.id\n          dialogVisible.value = false\n          emit('on-success', formData)\n        })\n+      }\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br")])]),a("ol",[a("li",[s._v("父组件修改数据")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("src/views/member/pay/components/checkout-address.vue\n    // 成功\n    const successHandler = (formData) => {\n+      const editAddress = props.list.find(item => item.id === formData.id)\n+      if (editAddress) {\n+        // 修改\n+        for (const key in editAddress) {\n+          editAddress[key] = formData[key]\n+        }\n+      } else {\n        // 添加\n        const json = JSON.stringify(formData) // 需要克隆下，不然使用的是对象的引用\n        // eslint-disable-next-line vue/no-mutating-props\n        props.list.unshift(JSON.parse(json))\n+      }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);